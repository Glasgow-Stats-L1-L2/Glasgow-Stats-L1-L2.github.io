# Example 1 - life expectancy (log-transformation on x)

Rossman (1994) collected information on life expectancy in various countries of the world and the densities of people per television set and of people per physician in those countries. <br>

The data is available in the `LifeExp.csv` file.
Remember you may need to reset your working directory and your data should be saved into that directory. <br>

```{r eval = FALSE, webex.hide="How to read in your data"}
life <- read.csv("LifeExp.csv")
```

In this practical, our focus is to identify how female life expectancy (Y , abbreviated to FLE) is related to the number of people per physician (x, abbreviated to PPP).

<br> (a) i. Create a scatterplot of `FLE` against `PPP`.

`r hide("Hint")` We can use the code`plot()`. What variables do we want on our x and y axis?
`r unhide()`

```{r eval = TRUE, echo = TRUE, webex.hide="Solution"}
plot(FLE ~ PPP, data = life)
```


(ii) Look at your plot and pick the correct statement.
```{r, echo = FALSE}
opts_n <- c("There is no relationship between Female Life Expectancy and People per Phyisician", answer = "There is an inverse relationship between Female Life Expectancy and People per Phyisician and as PPP increases, FLE decreases", "There is an inverse relationship between Female Life Expectancy and People per Phyisician and as PPP increases FLE increases")
```
`r longmcq(opts_n)`

<br> As the relationship appears to be **non-linear**, we might want to apply a transformation to the predictor variable. 
Transforming the values of x might be the first thing to try if there is a non-linear monotonic (i.e. entirely non-increasing or entirely non-decreasing) trend in the data, and non-linearity is the only problem (i.e the model assumptions: independence, zero-mean, constant variance and normality should be met). <br>

(iii) What transformation should we apply here:
`r mcq(c(answer = "Logarithmic", "Square-root", "No transformation"))` <br>

(iv) Create a new scatterplot of female life expectancy against the transformed PPP variable:

`r hide("Hint")` We can use the code`plot()` again. Change x to be the log of your predictor variable. You may need to change the axis label too. 
`r unhide()`

```{r eval = TRUE, echo = TRUE, webex.hide="Solution"}
plot(FLE ~ log(PPP), data = life, xlab = "log(PPP)")
```

## Statistical Analysis

The model for the relationship between `FLE` and `log(PPE)` is therefore:
$Y_i = \alpha + \beta \cdot log(x_i) + \epsilon_i$, where $\epsilon_i \sim N(0, \sigma^2)$ and $i = 1, . . . , 37.$

<br> (b) What type of model is this?
`r mcq(c(answer = "Simple Linear Regression", "Multiple Regression", "Non-linear Regression"))` <br>

(i) Use the `lm()` function to fit this model to your plot:
help(lm)

`r hide("Hint")` Use the `help(lm)` function  to see what parameters you need within the function.
`r unhide()`

```{r eval = TRUE, echo = TRUE, webex.hide="Solution"}
Model1 <- lm(FLE ~ log(PPP), data = life)
```
## Assumption Checking
<br>(c) i. Model assumptions can be assessed graphically by producing a plot of the residuals versus the fitted values and a normal probability plot (Q-Q plot) of the residuals.

`r hide("Hint")` Use the `plot(rstandard()~fitted())` function for the residual plot and the code `qqnorm` for the Q-Q plot.
`r unhide()`

```{r eval = TRUE, echo = TRUE, webex.hide="Solution"}
plot(rstandard(Model1) ~ fitted(Model1))
qqnorm(rstandard(Model1))
```
(ii) The residual vs fitted values plot shows that the points `r mcq(c(answer = "are", "are not"))` fairly evenly scattered above and below the`r mcq(c("mean line", answer ="zero line"))`, which suggests it `r mcq(c(answer = "is", "is not"))` reasonable to assume that the random errors have mean equal to `r mcq(c("µ", answer ="zero"))`. The vertical variation of the points seems to be small for small fitted values. However, there are also fewer points in this case. It would be preferable if `r mcq(c(answer = "more", "less"))` data were available. <br>

(iii) In the normal probability plot, we see that points `r mcq(c("do", answer = "do not"))` exactly lie on diagonal line. This indicates that the Normality assumption `r mcq(c("may", answer = "may not"))`be satisfied. <br>

(iv) The independence of the random errors `r mcq(c(answer = "seems", "does not seem"))` reasonable since each point refers to a different country.

## Regression output
<br> (d) i. Load the summary statistics: 
```{r eval = TRUE, echo = TRUE, webex.hide="Solution"}
summary(Model1)
```
<br>

(ii) Fill in the blanks in the regression equation with the calculated parameters to 2 decimal places:

$FLE$ = `r fitb(109.95)` − $\bigg($`r fitb(5.49)` $\cdot$ $log(PPP)\bigg)$ <br>
<br>

(iii) Interpret the parameters correctly and enter any numbers to 2 decimal places:

This means the female life expectancy is `r mcq(c("seems", answer = "does not seem"))` related to the number of people per physician. If log(PPP) increases by 1 unit, the expected female life expectancy `r mcq(c("increases", answer = "decreases"))` by `r fitb(5.49)`.<br><br>

(iv) Using the created model predict the life expectancy if the number of people per physician is 4000, to 2 decimal places:

`r hide("Hint")` When predicting the value of the response for a new observation, we need to back transform the variable.
`r unhide()`

$FLE$ = `r fitb(109.95)` − $\bigg($`r fitb(5.49)` $\cdot$ $log($`r fitb(109.95)`$)\bigg)$ = `r fitb(64.42)`
